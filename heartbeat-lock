#!/bin/bash
# Heartbeat Lock Manager CLI
# Usage: heartbeat-lock.sh {acquire|release|force-release|status|is-locked}

AUTONOMY_DIR="${AUTONOMY_DIR:-/root/.openclaw/workspace/skills/autonomy}"
source "$AUTONOMY_DIR/lib/heartbeat-lock.sh"

# Command dispatch
case "${1:-status}" in
    acquire)
        acquire_lock "${2:-cli}"
        ;;
    release)
        release_lock
        ;;
    force-release)
        force_release
        ;;
    status|check)
        check_status
        ;;
    is-locked)
        if check_status | grep -q "LOCKED:"; then
            exit 0
        else
            exit 1
        fi
        ;;
    *)
        echo "Usage: $0 {acquire|release|force-release|status|is-locked}"
        echo ""
        echo "Commands:"
        echo "  acquire [caller]  - Try to acquire heartbeat lock"
        echo "  release           - Release lock (if owned by current process)"
        echo "  force-release     - Force remove lock (for emergencies)"
        echo "  status            - Check lock status"
        echo "  is-locked         - Exit 0 if locked, 1 otherwise"
        exit 1
        ;;
esac
